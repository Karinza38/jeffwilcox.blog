---
layout: post
comments: true
title: ! 'Please ship your next Windows Phone app with GZip: speed requests 50-80%'
wordpress_id: 887
wordpress_url: http://www.jeff.wilcox.name/?p=887
imported_categories:
- title: c#
  slug: csharp
  autoslug: c#
- title: windows-phone
  slug: windows-phone
  autoslug: windows-phone
imported_link_categories: []
tags: []
---
<p>Please ship your next Windows Phone app or app update using this awesome GZipWebClient library by Morten Nielsen (<a href="http://nuget.org/packages/SharpGIS.GZipWebClient">NuGet</a>, <a href="http://www.sharpgis.net/post/2011/08/28/GZIP-Compressed-Web-Requests-in-WP7-Take-2.aspx">blog post</a>, <a href="http://www.sharpgis.net/www.sharpgis.net/file.axd?file=2011%2f8%2fSharpGIS.GZipWebClient.zip">source</a>) – it’s been out there since August and we should all be using this now for HTTP-heavy apps!</p>  <p>The next update of my app is in the works and performance is significantly improved by this library. I used both generation 1 and gen 2 devices to gather a ton of data and am loving the results. Can’t wait to submit the update to the marketplace. I’ve been seeing requests speed up 50%-80%, it’s amazing – but I should note, these are unofficial numbers, I’m just grabbing these from my app that is JSON-heavy.</p>  <p><img style="background-image: none; border-bottom: 0px; border-left: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="GZipChart" border="0" alt="GZipChart" src="http://www.jeff.wilcox.name/wp-content/uploads/2012/01/GZipChart.png" width="680" height="310" /></p>  <p><em>Some sample data: a large set of averaged requests of a very large JSON request to the Foursquare web services used in my app, 4th &amp; Mayor for Windows Phone 7.5.</em></p>  <p>These numbers aren’t official or anything like that, just what I was observing using my 3G data connection here in Seattle or home WiFi. Also interesting are the fastest times for the content – I often found that once a data connection was open, I would get as low as 100ms for some GZip requests. Just amazing.</p>  <p>One of the awesome modern web server features that nearly every browser happily supports today is <a href="http://en.wikipedia.org/wiki/Gzip">Gzip</a> compression of its output. Text and JSON beautifully compress, often by more than half, resulting in quick content downloads. It’s a simple and awesome way to improve the performance and responsiveness of your applications.</p>  <p>This isn’t a new technology, but unfortunately it isn’t just a default, built-in option for you to use in your Windows Phone apps, and you can expect that competing apps on other platforms (and even on Windows Phone) will be using Gzip to improve the performance. Hopefully we fix this in the future.</p>  <p>Frankly it isn’t a default in most mobile platforms, either, and you need to opt-in. However, some, like iOS, seem to automatically deflate incoming streams as long as you opt-in by setting the content encoding headers; in an iOS app, you just addValue “gzip” forHTTPHeaderField before your request and you’re good from there. Android is similar but you do need to check for gzip in responses and manually new up a deflating stream with GZipInputStream.</p>  <h3>HTTP Gzip and Windows Phone apps</h3>  <p>So Morten Nielsen created a wrapping WebClient library over 6 months ago and through a few iterations has made it great.</p>  <p>So now it’s super easy to get this perf win. To make this work:</p>  <ul>   <li>Add the library to your project via <a href="http://nuget.org/packages/SharpGIS.GZipWebClient">NuGet</a> [SharpGIS.GZipWebClient]</li>    <li>Replace your WebClient code to use GZipWebClient instead – yes, just rename! (GZipWebClient is in Morten’s `SharpGIS` namespace)</li>    <li>Test and ship your app!</li> </ul>  <p>Now I’m not considering the server-side, but if you’re rolling your own web services, you might need to do some work to make sure that you’ll serve GZip content when the capability is ready on the client. Check with the documentation for your server-side app platform, cloud provider or web server technology.</p>  <p>I can totally see myself adding this to my core libraries for all future projects. Hope this helps. <strong>Thanks Morten for providing this to the community!</strong> You can follow Morten on Twitter (<a href="https://twitter.com/#!/dotMorten">@dotMorten</a>) or check out his blog (<a href="http://www.sharpgis.net/">http://www.sharpgis.net/</a>).</p>  <p>(And on the performance side: the smaller payload means networking rocks and is fast; it is worth noting that GZip adds a small amount of CPU load – hopefully in your background thread – but I haven’t detected anything negative from this yet)</p>
