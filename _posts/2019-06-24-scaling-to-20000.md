---
layout: post
comments: false
title: "Scaling from 2,000 to 25,000 engineers on GitHub at Microsoft"
categories: [microsoft, open-source]
tags: [tech, github, opensource, scale, ospo, compliance, nodejs]
neighborhood: "BUILDING 17"
location: "REDMOND, WA USA"
---

At Microsoft today we have about 25,000 engineers participating in our official
GitHub organizations for open source, as well as contributing to open source
communities throughout GitHub.

In sheer numbers, we're operating at 10X the scale we were when I posted in 2015 about our
early experience [scaling from 20 to 2,000 engineers](https://jeffwilcox.blog/2015/11/azure-on-github/)
in the Azure open source org.

Now feels like a good time to share more of the experiences
I've had as a member of Microsoft's Open Source Programs Office (OSPO) as we have
matured, grown and scaled this effort together.

In this post, I will cover:

- Core principles we have adopted with our open source and GitHub experience
- Technical investments we have made to scale
- Program investments of note
- Key learnings
- Looking to the future
- Resources including the open source projects mentioned in this post

I'm focusing more on the tactical approach we took to using GitHub at scale
than I am on the cultural learnings or any specific project's experience -
though I hope we can help amplify and share the experiences projects have
been having.

It should be no surprise that open source is a big part of what has helped us to
scale and to give back:

- we've adopted CLA Assistant, open sourced by SAP, and now contribute to the same project, after throwing away our home-built, aging solution for Contributor License Agreements (CLAs)
- our self-service GitHub management tooling is open source
- we're using an open source attribution engine built by Amazon
- we're collaborating together on Clearly Defined, an OSI project, to crawl all the open source projects we can find to discover license, copyright, and other data... curating that data in the open on GitHub, making all that collective data available
- our team has even invested in moving to more common open services and systems such as containers and Postgres and MongoDB to make it easier to collaborate with other companies and stacks
- we regularly use [VS Code](https://github.com/microsoft/vscode), [TypeScript](https://github.com/microsoft/TypeScript), [Kubernetes](https://github.com/kubernetes/kubernetes), [Webpack](https://github.com/webpack), and thousands of open libraries.

Looking forward, we have a lot more work to do to focus on developing our
capabilities - evolving our maturity models around what healthy and awesome
projects look like, helping graduate work into the community and to
foundations, and continuing rapid iteration, experiments, and learning from
all of this.

I'm so excited to see where we are at in another few years, and encouraged by
some of the new projects where we're starting to see new communities and
interst develop such as
[Terminal](https://github.com/microsoft/terminal),
[Accessibility Insights](https://accessibilityinsights.io),
and
[Windows Calculator](https://github.com/microsoft/calculator).

# Principles we've adopted

To encourage the best behaviors and help teach Microsoft employees how to use
GitHub and participate in communities, we've identified a number of tenants or
principles that we try and use in everything that OSPO does specific to our
tooling.

## Transparency

Open source centers around collaboration, but one of the challenges today with
GitHub orgs full of many repos is identifying what teams have access to accept
pull requests or administer settings.

While GitHub shows a lot of this data if you start with the Teams view in an org
and drill into a specific team, there's no view for a given repo's teams, unless
you're an admin for that repo.

For all of our repos, releases and reviews,

- Our portal exposes the given teams that control each repo
- All the release requests and data are stored in work items available to any employee
- Our portal for GitHub management shows all GitHub Teams, including 'secret' or hidden teams
- We enable cross-org search in our portal, to more easily locate similarly-named teams and repos across orgs, reducing confusion and internal support costs

## Eliminate / Simplify

If at all possible, we'd rather remove complexity and process and steps. It's not
always possible, but if we continually ask questions of how we approach workflows
and guidance, hopefully we'll test the edges and eliminate where possible.

## Self-service

We'd rather not be a roadblock on operations at all. The traditional GitHub model
involves needing to be invited by username or e-mail to each GitHub organization.

For any employee, we allow automatic self-service join by automating the sending and
accepting of invitations behind the scenes, managed by our portal.

Whenever possible, we want to provide documents, guidance, and other reusable resources,
instead of having to rely on special knowledge or process that has manual steps.

## Delegation

We're advisors, trust our peers and the many businesses at the company, and hope
that our advice, information and tools are well-respected. We try and not stand
in the way of teams doing what they need when possible.

Decisions such as whether to release open source go through a question/answer
experience, and the outcome is either automatic approval, or a business approval
workflow that kicks off, allowing an individual team's business and legal
representatives handle work closest to them.

## Authentic GitHub

Engineers should learn how the GitHub interface works, how pull requests and
reviews, issues, forks, organization teams, and collaborators function.

Whenever possible, we hope that our users go directly to GitHub to manage their
teams, configure team maintainers, welcome new community members into their
projects as maintainers or contributors.

While we do have separate internal interfaces and tools, these help support the
native experience when possible, and we also use tools such as a browser
extension that we share with our users to help light up GitHub with hooks into
our internal tools or guides when needed.

This causes some confusion, compared with many traditional engineering practices
at Microsoft, where a new hire might apply for a single role-based access group,
or automatically get added to a security group on their first day, automatically
getting access to key systems, potentially even direct commit or write access.

We'd much rather our engineers learn about the fork-and-pull request model of
working on GitHub... contributing to another Microsoft open source project
should never require any special permissions, our engineers should just feel
comfortable submitting a pull request and taking it from there.

If someone does have a need to become a repository administrator or to get
permission to merge pull requests, then they should just go ahead and use the
GitHub user interface to request to join an appropriate team. As a result,
engineers learn about what GitHub teams are, the role of a team maintainer in
making delegated decisions, and how to think about the evolution of their
project and its permissions.

# Technical investments

Whenever possible we want to use open source to make open source better and
share that back with the world.

As we have grown by an order of magnitude and rolled our tooling out to
all of Microsoft, we have had to invest in specific areas to either
duct-tape around missing functionality, address mistakes and learnings we
all have, and work to stay on top of enabling our engineers to be
successful and work efficiently.

_I love focusing on the technical work that we have done, though remain
hopeful that as more companies explore open source at scale, and products
such as GitHub Enterprise Cloud evolve, that these sorts of features will
come more naturally to the marketplace, letting people like me focus more
on the human and program aspects of open source, and less on technical
implementation details, or running services._

## Adopting CLA Assistant

We host instances of an open source project for Contributor License Agreement (CLA)
management, integrated with GitHub, called [CLA Assistant](https://github.com/cla-assistant/cla-assistant) for Microsoft and the .NET Foundation.

CLA Assistant is an open source project that was started by SAP (yeah, another
big company, sharing!) and is licensed Apache 2.0.

Like many things in the open source program space, working together is ideal,
and so we have not only adopted the project, but also contributed a number of
changes to help with scale issues and rate limiting, automatic signing for
when employees join and leave the company, and are now looking to also adopt
a class of Corporate CLA / CCLA thanks to contributions made by others to the
upstream project.

We migrated from an in-house Contributor License Agreement (CLA) bot
that was originally deployed in 2017. I really liked how the [VSCode team messaged this to their community with a GitHub issue](https://github.com/Microsoft/vscode/issues/34239) (#34239)
and were able to inform and involve their maintainers of that change.

Once the CLA for an entity is signed once by a community member, they can then
contribute to all other repos, so it's really a relatively low burden that helps
keep our lawyer friends happy.

Some other nice benefits of this system for us:

- Uses modern features such as Status Checks to indicate the state
- Allows us to simplify the UI and no longer use GitHub issue labels to mark CLA status
- Org-level webhook integration means that the CLA is "always-on", with no need to specifically onboard new repos or worry about whether repos are protected

## 1ES Open Source Assistant Browser Extension

My favorite browser extension!

Works with Firefox, Chrome, and the new Edge based on Chromium

Microsoft employees can learn more and install the extension at [aka.ms/1esassistant](https://aka.ms/1esassistant).

## Data and Insights

GitHub provides useful information including traffic stats, contributor info and
other breakdowns at the repository level.

Across Microsoft's open source projects, however, we have a need to be able to slice
and dice data looking for trends over time, analyzing investments at scale, and so realized
early on that we needed to import all of the available data we can from our GitHub
open source releases into our own big data systems such as Azure Data Lake and Azure Data Explorer.

### GHTorrent



### GHCrawler

### Azure Data Explorer

### ClearlyDefined

## Regular automation jobs

We've implemented jobs that do everything from keeping data and caches up-to-date to
helping make sure that we have confidence in the membership of our GitHub organizations.

### Removing former employees

We have jobs connected to internal data sources that help us understand when
an employee has left the company. In a big company, people are always changing
roles, trying new things, and sometimes they leave for other opportunities.

We "unlink" people when they leave: removing the association between their GitHub
account and their corporate identity, and also removing their GitHub organization
membership(s).

We also send an e-mail to their former manager, so they have confidence that the
right things have happened with permissions and system access.

### Enforced "System Teams"

To help enable operations, support, meet security obligations, and light up bots
such as our CLA system, we have a set of GitHub teams that are _automatically_
and _permanently_ added to every repository in our GitHub orgs, when the job is
configured.

By monitoring the GitHub event bus, the job adds what we call *system teams* to
a repo the instant a new repo is created. And, if a repo admin tries to remove
or change the permissions that such a system team has, the job automatically
restores its permission.

An occassional cronjob also runs to validate and reenforce these teams as needed.

### Preventing big permission grants

As the number of members in a GitHub organization grows high, you'll also start
to see very large teams.

We have teams such as "All Employee Members" that are designed to give easy read
access to private repos that are being finished up and polished before going open
source.

An unintended side effect we found: some people wanted to just give "all members"
administrative access over their repo, to make the act of onboarding get much
easier.

Trouble is, with admin comes great power, and any of the thousands of members of
the org could then delete the repo, change whatever they want, override branch
protections, etc.

This also would automatically subscribe thousands of people
to spammy notification messages, depending on their GitHub notification
preferences.

As a result, we have a "large permissions" job that monitors for grants of write or
admin access to an org-defined "large" number of people. Once such a grant is made,
and the team is too large, the job will automatically downgrade the permissions to
try and prevent mistakes, and then send an e-mail address to the person who
made the permission choice, hoping to educate them about the risks and help them
understand what changes were made.

### GitHub username changes

GitHub allows users to change their username. This is excellent: many people start
with a cute screen name or other indicator, then realize they're professionally
developing software with their peers in the industry, and often want to change that
username.

Not all users know that they can rename their account, so we do get people who delete
an account, just to create a new one.

However, the majority of GitHub apps and APIs work off of GitHub _usernames_ instead of
the integer-based _user ID_.

To help stay ahead of this, we have a cronjob that looks up GitHub users by _ID_ and then
refreshes our internal data store of those usernames, in the hope that we can improve
the API success rate and reduce support costs when renames happen.

For critical operations, additional logic has been added to GitHub apps to anticipate
the potential of a user rename happening, and being able to smartly attempt to fallback to
looking up the user first by ID, or alerting and sending the issue to operational support.

### Weekly and daily digests

We have a cronjob that sends updates about new changes and interesting happenings on
GitHub repos. These are typically only send to repo admins, to not spam too many
people.

The digests are personalized to the receipient, and cover scenarios such as:

- notifying the creator of a repo, and their manager, of the new repo
- notifying when the # of admins becomes rather high, so that team maintainers can cleanup permissions
- abandoned repos that haven't been touched in years
- when a team is down to a single maintainer, suggesting they appoint another maintainer or two
- when a repository has been flipped from private to public

## New repo wizard

## Release reviews

## Configuring GitHub settings

Verifying our official organizations

Recommended org configuration

## Build-time discovery and integration



# Program investments

## Docs

## Monthly newsletter

## Open Source Meetup

## Open Source Champs

## Internal support

## Data access

## Executive council and briefings

# Learnings

## GitHub API lessons

### Rate Limiting and being a good citizen

### User renames

## Painpoints at scale

### Two-factor authentication

including iPhone story

### Massive teams

Discussions Bedlam story

### Team vs Individual repo permissions

### Losing your own administrative repo access

### Transparency around permissions

### App approvals, granularity, intent

### Paying for third-party services

### GitHub org proliferation

shipping the org chart

### Paying GitHub

invoice model (annual lump-sum payment)

lfs model

in the end I guess we opted to pay a few billion more, highly recommend this approach

## Software learnings

### Open source collaboration is great

Portal

Scallion

ClearlyDefined

### Migrating to TypeScript

## Infrastructure learnings

### Job resiliency and third-party services

### Our move to AKS

### Azure Pipelines and Kubernetes support

## Human challenges

### Private engineering

### Products vs Projects

### Transferring repos created by individuals

### Forking

### Naming and control of similar projects

### Big company communication

### Rolling out 2FA

### Rolling out third-party app restrictions

### Handling Code of Conduct and community situations

### E-mail to broad aliases

### People want more open source

MSMoney

Age of Empires

Our OS

### Guidance, decision process, many opinions

Up-for-grabs experiment

Org casing change

# Looking forward

We are looking to migrate more of our organizations to GitHub Enterprise Cloud

We're excited to see what the engineering system and inner source teams do for private engineering

## Playbooks and resources

## Encouraging more contribution

## Sharing our docs

People are desperate to learn from experiences

Kudos and callout to Google

opensource guide

## New GitHub features

New maintainer and etc. roles for work items

Ability to transfer issues between repos

Audit logs

Can't wait to see what is next

# Open Source Resources

opensource guide

## Repos

[cla assistant: cla-assistant/cla-assistant](https://github.com/cla-assistant/cla-assistant)

[amzn/oss-attribution-builder](https://github.com/amzn/oss-attribution-builder)

[clearlydefined/crawler](https://github.com/clearlydefined/crawler)

[clearlydefined/curated-data](https://github.com/clearlydefined/curated-data)

[microsoft/opensource-portal](https://github.com/Microsoft/opensource-portal)

[microsoft/ghcrawler](https://github.com/microsoft/ghcrawler)



Hope this helps,

<i>Jeff Wilcox<br />
Software Engineer<br />
Microsoft Open Source Programs Office</i>
